{% extends "base_new.html" %}
{% load static %}
{% block content %}
<div class="w-full h-full relative bg-gray-50 border-gray-200">
<div class="w-[1184px] h-24 relative bg-white border-b border-gray-200">
    <div class="w-[1136px] h-14 left-[24px] top-[16px] absolute bg-black/0 border-gray-200 inline-flex justify-between items-center">
        <div class="w-96 h-14 relative bg-black/0 border-gray-200">
            <div class="w-96 h-8 left-0 top-0 absolute bg-black/0 border-gray-200 inline-flex justify-start items-center gap-3">
                <div class="w-3.5 h-6 relative bg-black/0 border-gray-200">
                    <div class="w-3.5 h-5 left-0 top-[2px] absolute bg-black/0 border-gray-200">
                        <div class="w-3.5 h-4 left-0 top-[2px] absolute inline-flex justify-center items-center">
                            <div class="w-3.5 h-4 relative bg-black/0 border-gray-200 overflow-hidden">
                                <!-- <div class="w-3.5 h-3 left-0 top-[2px] absolute bg-gray-400"></div> -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="w-64 h-8 relative bg-black/0 border-gray-200">
                    <div class="w-64 h-8 left-0 top-[1px] absolute justify-start text-gray-900 text-2xl font-bold font-['Inter']truncate whitespace-nowrap overflow-hidden">Location Management</div>
                </div>
            </div>
            <div class="w-96 h-5 left-0 top-[36px] absolute bg-black/0 border-gray-200">
                <div class="w-96 h-5 left-0 top-[1px] absolute justify-start text-gray-600 text-sm font-normal font-['Inter'] truncate">Manage location families and types for service requests</div>
            </div>
        </div>
        <div class="w-80 h-10 bg-black/0 border-gray-200 flex justify-start items-center gap-4">
            <div class="w-64 h-10 relative bg-black/0 border-gray-200">
                <div class="w-64 h-10 left-0 top-0  bg-white rounded-lg outline outline-1 outline-offset-[-1px] outline-gray-200">
                    <input id="searchInput"
             type="text"
             placeholder="Search locations..." class="w-64 h-10 left-[60px] top-0  px-9 rounded lg  text-gray-400 text-base font-normal font-['Inter'] leading-normal outline-none" data-name="{{ family.name|lower }}"/>
                </div>
                <div class="w-4 h-6 left-[12px] top-[9px] absolute bg-black/0 border-gray-200">
                    <div class="w-4 h-4 left-0 top-[4px] absolute inline-flex justify-center items-center">
                        <img src="{% static 'icon/search.svg'%}" class="w-4 h-4 relative bg-black/0 border-gray-200 overflow-hidden">
                            <!-- <div class="w-4 h-4 left-0 top-0 absolute bg-gray-400"></div> -->
                        <!-- </div> -->
                    </div>
                </div>
            </div>
            <div class="w-7 h-10 relative bg-black/0 rounded-lg border-gray-200">
                <div class="w-3.5 h-5 left-[8px] top-[10px] absolute bg-black/0 border-gray-200">
                    <div class="w-3.5 h-4 left-0 top-[2px] absolute inline-flex justify-center items-center">
                        <div class="w-3.5 h-4 relative bg-black/0 border-gray-200 overflow-hidden">
                            <!-- <div class="w-3.5 h-4 left-0 top-0 absolute bg-gray-600"></div> -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="w-7 h-10 relative bg-black/0 rounded-lg border-gray-200">
                <div class="w-3.5 h-5 left-[8px] top-[10px] absolute bg-black/0 border-gray-200">
                    <div class="w-3.5 h-4 left-0 top-[2px] absolute inline-flex justify-center items-center">
                        <div class="w-3.5 h-4 relative bg-black/0 border-gray-200 overflow-hidden">
                            <!-- <div class="w-3.5 h-4 left-0 top-0 absolute bg-gray-600"></div> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- sub tab -->
{% include "partials/location_tab.html" %}



<div class="w-[1184px] min-h-screen relative bg-black/0 border-gray-200">
    <div class="w-[1136px] h-[634px] left-[24px] top-[24px] absolute bg-black/0 border-gray-200">
        <div class="w-[1136px] h-12 left-0 top-0 absolute bg-black/0 border-gray-200 inline-flex justify-between items-center">
            <div class="w-96 h-12 relative bg-black/0 border-gray-200">
                <div class="w-96 h-7 left-0 top-0 absolute bg-black/0 border-gray-200">
                    <div class="w-44 h-7 left-0 top-[2px] absolute justify-start text-gray-900 text-xl font-semibold font-['Inter']">Location Families</div>
                </div>
                <div class="w-96 h-5 left-0 top-[32px] absolute bg-black/0 border-gray-200">
                    <div class="w-96 h-5 left-0 top-[1px] absolute justify-start text-gray-600 text-sm font-normal font-['Inter'] truncate">Group related location types together for better organization</div>
                </div>
            </div>
            <div class="w-32 h-9 relative bg-sky-600 rounded-lg border-gray-200">
                <div class="w-3 h-4 left-[19.72px] top-[9px] absolute bg-black/0 border-gray-200">
                    <div class="w-3 h-3.5 left-0 top-[1.75px] absolute inline-flex justify-center items-center">
                        <img src="{% static 'icon/plus.svg'%}" class="w-3 h-3.5 relative bg-black/0 border-gray-200 overflow-hidden">
                            <!-- <div class="w-3 h-3 left-[0.44px] top-[1.31px] absolute bg-white"></div> -->
                        <!-- </div> -->
                    </div>
                </div>
                <a href="{% url 'family_add' %}" class="w-20 h-5 left-[39.97px] top-[9px] absolute text-center justify-start text-white text-sm font-medium font-['Inter']">Add Family</a>
            </div>
        </div>


        <div class="w-[1136px] mt-24 grid grid-cols-3 gap-6">
 {% for family in families %}
    <div class="w-96 h-64 bg-white rounded-xl shadow-[0px_1px_2px_0px_rgba(0,0,0,0.05)] outline outline-1 outline-offset-[-1px] outline-gray-200 relative family-card" data-name="{{ family.name|lower }}">
        
        <div class="w-80 h-10 left-[25px] top-[25px] relative bg-black/0 border-gray-200 inline-flex justify-between items-center">
            <div class="w-40 h-10 bg-black/0 border-gray-200 flex justify-start items-center gap-3">
                <div class="w-10 h-10 bg-sky-600/10 rounded-lg border-gray-200 flex justify-center items-center">
                    <div class="w-5 h-6 relative bg-black/0 border-gray-200">
                        <div class="w-5 h-4 left-0 top-[4px]  inline-flex justify-center items-center">
                            <div class="w-5 h-4 relative bg-black/0 border-gray-200 overflow-hidden">
                                <div class="w-5 h-3.5 left-0 top-[1px] absolute bg-sky-600"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="w-24 h-10 relative bg-black/0 border-gray-200">
                    <div class="w-24 h-6 left-0 top-0 absolute bg-black/0 border-gray-200">
                        <div class="w-24 h-6 left-0 top-[2px] absolute justify-start text-gray-900 text-base font-semibold font-['Inter'] truncate whitespace-nowrap overflow-hidden">{{ family.name }}</div>
                    </div>
                    <div class="w-24 h-4 left-0 top-[24px] absolute bg-black/0 border-gray-200">
                        <div class="w-24 h-4 left-0 top-0 absolute justify-start text-gray-600 text-xs font-normal font-['Inter']">+{{ family.types.count }} location types</div>
                    </div>
                </div>
            </div>
            <div class="w-1 h-6 relative bg-black/0 border-gray-200">
                <div class="w-1 h-5 left-0 top-[2px] absolute bg-black/0 border-gray-200">
                    <div class="w-1 h-4 left-0 top-[2px] absolute inline-flex justify-center items-center">
                        <img src="{% static 'icon/dot.svg'%}" class="w-1 h-4 relative bg-black/0 border-gray-200 overflow-hidden">
                            <!-- <div class="w-1 h-3.5 left-[0.25px] top-[1.25px] absolute bg-gray-400"></div> -->
                        <!-- </div> -->
                    </div>
                </div>
            </div>
        </div>

        <div class="w-80 h-28 left-[25px] top-[81px] absolute bg-black/0 border-gray-200">
            <div class="w-80 h-6 left-0 top-0 relative bg-black/0 border-gray-200 inline-flex justify-between items-center">
                {% for loc in family.types.all|slice:":5" %}
                <div class="w-24 h-5 relative bg-black/0 border-gray-200">
                    <div class="w-24 h-5 left-0 top-[1px] absolute justify-start text-gray-600 text-sm font-normal font-['Inter']">{{ loc.name }}</div>
                </div>
                <div class="w-12 h-6 relative bg-green-500/10 rounded-full border-gray-200">
                    {% if loc.is_active %}
                    <div class="w-10 h-4 left-[8px] top-[4px] absolute justify-start text-green-500 text-xs font-normal font-['Inter']">Active</div>
                    {%else %}
                    <div class="w-10 h-4 left-[8px] top-[4px] absolute justify-start text-red-500 text-xs font-normal font-['Inter']">Inactive</div>
                    {% endif %}
                </div>
                {% endfor %}
                {% if family.types.count > 5 %}
                <div class="w-80 h-4 left-0 top-[96px] relative bg-black/0 border-gray-200">
                    <div class="w-20 h-4 left-0 top-0 relative justify-start text-gray-400 text-xs font-normal font-['Inter']">+{{ family.types.count|add:"-5" }} more types</div>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="w-80 h-8 left-[25px] top-[209px] absolute bg-black/0 border-t border-gray-200">
            <div class="w-80 h-4 left-0 top-[17px] relative bg-black/0 border-gray-200 inline-flex justify-between items-center">
                {% if default_checklist %}
                <div class="w-24 h-4 relative bg-black/0 border-gray-200">
                    <div class="w-24 h-4 left-0 top-0 absolute justify-start text-gray-600 text-xs font-normal font-['Inter'] truncate">Default Checklist:</div>
                </div>
                <div class="w-20 h-4 relative bg-black/0 border-gray-200">
                    <div class="w-20 h-4 left-0 top-0 absolute justify-start text-gray-600 text-xs font-medium font-['Inter']truncate whitespace-nowrap overflow-hidden">{{ default_checklist.name }}</div>
                </div>
                {% endif %}
            </div>
        </div>

    </div>
    {% endfor %}
</div>
    </div>
<script>
document.getElementById('searchInput').addEventListener('input', function() {
  const query = this.value.toLowerCase();
  document.querySelectorAll('.family-card').forEach(card => {
    const name = card.dataset.name;
    card.style.display = name.includes(query) ? 'block' : 'none';
  });
}); 

document.getElementById('searchInput').addEventListener('input', function () {
  fetch(`/locations/search/?q=${encodeURIComponent(this.value)}`)
    .then(r => r.json())
    .then(data => {
      console.log('Search results:', data.results);
    });
});

document.getElementById('addFamilyBtn').addEventListener('click', function () {
  const name = prompt('Enter new family name:');
  if (!name) return;

  const csrftoken = '{{ csrf_token }}';
  fetch('{% url "add_family" %}', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
      'X-CSRFToken': csrftoken
    },
    body: new URLSearchParams({name})
  })
  .then(r => r.json())
  .then(data => {
    if (data.success) {
      alert('Family added successfully!');
      location.href = `/locations/${data.family_id}/`;
    } else {
      alert('Error: ' + (data.error || 'Unknown error'));
    }
  });
});
</script>


{% endblock %}